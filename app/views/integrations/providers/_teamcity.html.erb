<%= render FormComponent.new(model: [app, integration], url: app_teamcity_integration_path(app)) do |f| %>
  <% f.with_section(heading: "TeamCity Server") do |section| %>
    <% section.with_description do %>
      <p>Connect your TeamCity server</p>
      <p class="mt-2 text-xs">
        <%= link_to_external "How to create an access token?",
              "https://www.jetbrains.com/help/teamcity/managing-your-user-account.html#Managing+Access+Tokens",
              class: "underline" %>
      </p>
    <% end %>

    <%= section.F.hidden_field :category, value: category %>

    <% section.F.fields_for :providable do |subf| %>
      <%= subf.hidden_field :type, value: integration.providable_type %>
      <div><%= subf.labeled_text_field :server_url, "Server URL", required: true, placeholder: "https://teamcity.example.com" %></div>
      <div class="mt-4"><%= subf.labeled_text_field :access_token, "Access Token", required: true %></div>
    <% end %>
  <% end %>

  <% f.with_section(heading: "Cloudflare Zero Trust (Optional)") do |section| %>
    <% section.with_description do %>
      <p>If your TeamCity server is behind Cloudflare Zero Trust, provide a service token.</p>
      <p class="mt-2 text-xs">
        <%= link_to_external "How to create a service token?",
              "https://developers.cloudflare.com/cloudflare-one/identity/service-tokens/",
              class: "underline" %>
      </p>
    <% end %>

    <% section.F.fields_for :providable do |subf| %>
      <div><%= subf.labeled_text_field :cf_access_client_id, "CF-Access-Client-Id", placeholder: "xxxxxxxx.access" %></div>
      <div class="mt-4"><%= subf.labeled_text_field :cf_access_client_secret, "CF-Access-Client-Secret" %></div>
    <% end %>
  <% end %>

  <% f.with_action do %>
    <%= f.F.authz_submit "Create", "plus.svg", size: :xs %>
  <% end %>
<% end %>
