<% breadcrumb :app_config, @config %>
<%= form_with(model: [@app, @config],
              url: app_app_config_path(@app, @config),
              method: :patch) do |form| %>
  <div class="mb-8 pb-8 border-b">
    <h1 class="text-2xl md:text-3xl text-slate-800 font-bold">Configure ⚙️</h1>
  </div>

  <div class="grid gap-5 md:grid-cols-2">
    <div>
      <%= form.label :code_repository, "Code Repository", class: "block text-sm font-medium mb-1" %>
      <%= form.select :code_repository,
                      options_for_select(
                        @code_repositories.map { |chan| [chan[:name], { chan[:id] => chan[:name] }.to_json] },
                        @config.code_repository.to_json
                      ),
                      {},
                      { class: "form-input w-full" } %>
    </div>

    <% if @app.notifications_set_up? %>
      <div>
        <%= form.label :notification_channel, "Notification Channel", class: "block text-sm font-medium mb-1" %>
        <%= form.select :notification_channel,
                        options_for_select(
                          @notification_channels,
                          @config.notification_channel.to_json
                        ),
                        {},
                        { class: "form-input w-full", data: { controller: "input-select" } } %>

        <div class="text-sm mt-1">
          To receive notifications in <strong>private</strong> channels, <code>/invite @Tramline</code> into your
          private channel and then select it from this list.
        </div>
      </div>
    <% end %>

    <% if @ci_cd_projects.present? %>
      <div>
        <%= form.label :project_id, "#{@ci_cd_provider_name} Project", class: "block text-sm font-medium mb-1" %>
        <%= form.select :project_id,
                        options_for_select(
                          @ci_cd_projects,
                          @config.project_id.to_json
                        ),
                        {},
                        { class: "form-input w-full", data: { controller: "input-select" } } %>
      </div>
    <% end %>
  </div>

  <div class="mt-5">
    <!-- Start -->
    <%= form.submit 'Update', class: "btn bg-indigo-500 hover:bg-indigo-600 text-white" do %>
      <svg class="w-4 h-4 fill-current opacity-50 shrink-0" viewBox="0 0 16 16">
        <path d="M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"/>
      </svg>
    <% end %>
  </div>
<% end %>
