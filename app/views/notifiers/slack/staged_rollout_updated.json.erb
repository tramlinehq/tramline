<%
if @is_fully_released
main_text = "Your staged rollout is *complete*, and your update has rolled out to all users."
secondary_text = "View your release on the Play Console."
else
main_text = "Your staged rollout is *active*, and you are currently on stage *#{@current_stage} (#{@rollout_percentage}%)*."
secondary_text = "You can choose to *Pause* or *Release to 100%*."
end
 %>

{
  "blocks": [
    {
      "type": "context",
      "elements": [
        {
          "type": "image",
          "image_url": "https://storage.googleapis.com/tramline-public-assets/default_android.png",
          "alt_text": "app"
        },
        {
          "type": "mrkdwn",
          "text": "*<%= @app_name %> (<%= @app_platform %>)* <%= @train_current_version %>"
        }
      ]
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "<%= main_text %>"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "<%= secondary_text %>"
      }
    },
    {
      "type": "divider"
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "image",
          "image_url": "https://storage.googleapis.com/tramline-public-assets/tramline-small.png",
          "alt_text": "tramline"
        },
        {
          "type": "mrkdwn",
          "text": "<<%= @release_url %>|Live release>"
        }
      ]
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "image",
          "image_url": "https://storage.googleapis.com/tramline-public-assets/github-small.png",
          "alt_text": "github"
        },
        {
          "type": "mrkdwn",
          "text": "<<%= @release_branch_url %>|Release branch â€“ <%= @release_branch %>>"
        }
      ]
    },
    {
      "type": "divider"
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "plain_text",
          "text": "Release train: <%= @train_name %>",
          "emoji": true
        },
        {
          "type": "plain_text",
          "text": "<%= @step_type %> step: <%= @step_name %>",
          "emoji": true
        }
      ]
    }
  ]
}
