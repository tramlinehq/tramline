{
  "blocks": [
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": ":sparkles: New RC deployed for <%= @release_version %> (<%= @build_number %>)"
      }
    }
    <% @submissions.each do |submission| %>
    ,
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        <% if submission.deep_link.present? %>
          "text": "Submitted to <<%= submission.deep_link %>|*<%= submission.display %>*>"
        <% else %>
          "text": "Submitted to *<%= submission.display %>*"
        <% end %>
      }
    }
    <% end %>
    <% if @changes_since_last_run.present? %>
    ,
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": ":pushpin: Changes since last RC"
      }
    },
    {
      "type": "rich_text",
      "elements": [
        {
          "type": "rich_text_list",
          "style": "bullet",
          "elements": [
            <% @changes_since_last_run[0..changes_limit].each_with_index do |change, i| %>
            <%= i.zero? ? "" : "," %>
            {
              "type": "rich_text_section",
              "elements": [
                {
                  "type": "text",
                  "text": <%= change.truncate(commit_truncate_length).to_json %>
                }
              ]
            }
            <% end %>
          ]
        }
      ]
    }
    <% if @changes_since_last_run.size > changes_limit %>
    ,
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "RC changelog continued in thread :thread:"
        }
      ]
    }
    <% end %>
    ,
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "Full release changelog in :thread:"
        }
      ]
    }
    <% elsif @changes_since_last_release.present? %>
    ,
    {
      "type": "header",
      "text": {
        "type": "plain_text",
        "text": ":pushpin: Changes since last release"
      }
    },
    {
      "type": "rich_text",
      "elements": [
        {
          "type": "rich_text_list",
          "style": "bullet",
          "elements": [
            <% @changes_since_last_release[0..changes_limit].each_with_index do |change, i| %>
            <%= i.zero? ? "" : "," %>
            {
              "type": "rich_text_section",
              "elements": [
                {
                  "type": "text",
                  "text": <%= change.truncate(commit_truncate_length).to_json %>
                }
              ]
            }
            <% end %>
          ]
        }
      ]
    }
    <% if @changes_since_last_release.size > changes_limit %>
    ,
    {
      "type": "context",
      "elements": [
        {
          "type": "mrkdwn",
          "text": "Changelog continued in thread :thread:"
        }
      ]
    }
    <% end %>
    <% end %>
  ]
}
