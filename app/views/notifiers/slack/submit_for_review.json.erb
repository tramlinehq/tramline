<%
 if @is_play_store_production
 publishing = "managed publishing"
 company = "Google"
 store = "Play Store"
 elsif @is_app_store_production
 publishing = "manual release"
 company = "Apple"
 store = "App Store"
 end
%>

{
  "blocks": [
    {
      "type": "context",
      "elements": [
        {
          "type": "image",
          "image_url": "<%= @platform_asset_link %>",
          "alt_text": "app"
        },
        {
          "type": "mrkdwn",
          "text": "*<%= @app_name %> (<%= @app_platform %>)* <%= @train_current_version %>"
        }
      ]
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": "*<%= @app_name %> (<%= @app_platform %>)* <%= @train_current_version %> has been submitted for review! :tada:"
      }
    },
    {
      "type": "section",
      "text": {
        "type": "mrkdwn",
        "text": ":spiral_note_pad: What's New\n\n`<%= @release_notes %>`"
      }
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "plain_text",
          "text": "- If <%= publishing %> is disabled, this update will auto-start the rollout upon approval by <%= company %>.",
          "emoji": false
        }
      ]
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "plain_text",
          "text": "- If <%= publishing %> is enabled, you'll need to manually release this update through the <%= store %>.",
          "emoji": false
        }
      ]
    },
    {
      "type": "divider"
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "image",
          "image_url": "https://storage.googleapis.com/tramline-public-assets/tramline-small.png",
          "alt_text": "tramline"
        },
        {
          "type": "mrkdwn",
          "text": "<<%= @release_url %>|Live release>"
        }
      ]
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "image",
          "image_url": "<%= @vcs_asset_link %>",
          "alt_text": "vcs"
        },
        {
          "type": "mrkdwn",
          "text": "<<%= @release_branch_url %>|Release branch â€“ <%= @release_branch %>>"
        }
      ]
    },
    {
      "type": "divider"
    },
    {
      "type": "context",
      "elements": [
        {
          "type": "plain_text",
          "text": "Release train: <%= @train_name %>",
          "emoji": true
        },
        {
          "type": "plain_text",
          "text": "<%= @step_type %> step: <%= @step_name %>",
          "emoji": true
        },
        {
          "type": "plain_text",
          "text": "Deployment: <%= @deployment_channel_type %> + <%= @deployment_channel_name %>",
          "emoji": true
        }
      ]
    }
  ]
}
