<div class="grid gap-5 md:grid-cols-2 border-b border-dashed pb-5">
  <div>
    <%= form.label :name, class: "block text-sm font-medium mb-1" %>
    <%= form.text_field :name, class: "form-input w-full", placeholder: "Enter step name..", required: true %>
  </div>

  <div>
    <%= form.label :description, class: "block text-sm font-medium mb-1" %>
    <%= form.text_area :description, class: "form-input w-full mb-1", placeholder: "Describe your step..." %>
  </div>

  <div><!-- to push away the next field to the right--></div>

  <div>
    <%= form.label :release_suffix, class: "block text-sm font-medium mb-1" %>
    <%= form.text_field :release_suffix, class: "form-input w-full", placeholder: "Eg: qa-staging", required: true %>
    <div class="text-sm mt-1">
      This is appended to the <strong>bundle identifier</strong> of the app.
    </div>
  </div>
</div>

<div class="sm:flex sm:justify-between sm:items-center mt-8 mb-2 pb-5">
  <p class="font-bold text-xl">
    How do we build your app?
  </p>
</div>

<div class="grid gap-5 md:grid-cols-1 border-b border-dashed pb-10">
  <div class="w-1/2">
    <%= form.label :ci_cd_channel, "CI workflow", class: "block text-sm font-medium mb-1" %>
    <div class="control">
      <%= form.select :ci_cd_channel,
                      options_for_select(@ci_actions.map { |action| [action[:name], { action[:id] => action[:name] }.to_json] }, @step.ci_cd_channel.to_json),
                      { class: "form-select" },
                      data: { controller: "input-select" } %>
    </div>

    <div class="text-sm mt-1">
      This CI workflow should generate a valid build artifact (aab/apk/ipa).
    </div>
  </div>
</div>

<div class="sm:flex sm:justify-between sm:items-center mt-8 mb-2 pb-5">
  <p class="font-bold text-xl">
    Where should we deploy?
  </p>

  <div class="grid grid-flow-col sm:auto-cols-max justify-start sm:justify-end gap-2">
    <%= button_to "#", data: { action: "nested-form#addAssociation" }, class: "btn bg-emerald-500 hover:bg-emerald-600 text-white" do %>
      <svg class="w-4 h-4 fill-current opacity-50 shrink-0" viewBox="0 0 16 16">
        <path d="M15 7H9V1c0-.6-.4-1-1-1S7 .4 7 1v6H1c-.6 0-1 .4-1 1s.4 1 1 1h6v6c0 .6.4 1 1 1s1-.4 1-1V9h6c.6 0 1-.4 1-1s-.4-1-1-1z"></path>
      </svg>

      <span class="ml-2">Add another deployment</span>
    <% end %>
  </div>
</div>

<div class="grid md:grid-cols-1 pb-5">
  <%= render "shared/note_box",
             message: "The generated build artifact above will be moved across the configured deployment channels below." %>
</div>

<div data-controller='build-channel' data-train="<%= @train.id %>" data-app="<%= @train.app.id %>" data-step="<%= @step.id %>">
  <div class="grid gap-5 md:grid-cols-2 pb-5">
    <%= form.fields_for :deployments, Deployment.new do |deployments_form| %>
      <div>
        <%= deployments_form.label :integration, class: "block text-sm font-medium mb-1" %>
        <%= deployments_form.select :integration, options_for_select(@step.train.build_channel_integrations),
                                    { class: "form-select" }, required: true, data: { controller: "input-select", action: 'change->build-channel#change' } %>
      </div>

      <div>
        <%= deployments_form.label :build_artifact_channel, class: "block text-sm font-medium mb-1" %>
        <%= deployments_form.select :build_artifact_channel,
                                    options_for_select(@build_channels),
                                    { class: "form-select" },
                                    data: { controller: "input-select" } %>
      </div>
    <% end %>
  </div>
</div>


