<%= render EnhancedTurboFrameComponent.new(:ci_cd_config) do %>
  <%= render FormComponent.new(model: [@app, @bitrise_integration], url: app_ci_cd_bitrise_config_path(@app), method: :patch) do |f| %>
    <% f.with_section(heading: "Select Bitrise Project") do |section| %>
      <% section.with_description do %>
        Choose the Bitrise project for CI/CD builds.
        <%= image_tag "integrations/logo_bitrise.png", title: "Bitrise", width: 22, class: "my-2" %>
      <% end %>

      <% if @ci_cd_apps.present? %>
        <div>
          <%= section.F.labeled_select :project_config,
                "App Name",
                options_for_select(
                  display_channels(@ci_cd_apps) { |app| "#{app[:name]} (#{app[:id]})" },
                  @ci_cd_apps.find { |app| app[:id] == @project_config&.dig("id") }&.to_json
                ),
                {include_blank: "Select a project"},
                data: {controller: "input-select"} %>
        </div>
      <% end %>
    <% end %>

    <% f.with_action do %>
      <%= f.F.authz_submit "Update", "plus.svg", size: :xs %>
    <% end %>
  <% end %>
<% end %>
