<%= render EnhancedTurboFrameComponent.new(:ci_cd_config) do %>
  <%= render FormComponent.new(model: [@app, @github_integration], url: app_ci_cd_github_config_path(@app), method: :patch) do |f| %>
    <% f.with_section(heading: "Select Repository") do |section| %>
      <% section.with_description do %>
        Primary working code repository for CI/CD builds.
        <%= image_tag "integrations/logo_github.png", title: "GitHub", width: 22, class: "my-2" %>
      <% end %>

      <div>
        <%= section.F.labeled_select :repository_config,
              "Code Repository",
              options_for_select(
                display_channels(@code_repositories) { |repo| repo[:full_name] },
                @code_repositories.find { |repo| repo[:id] == @github_integration.repository_config&.dig("id") }&.to_json
              ) %>
      </div>
    <% end %>

    <% f.with_action do %>
      <%= f.F.authz_submit "Update", "plus.svg", size: :xs %>
    <% end %>
  <% end %>
<% end %>
