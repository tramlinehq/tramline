<h2 class="text-2xl text-slate-800 font-bold mb-6">Ongoing Releases</h2>

<table class="table-auto w-full">
  <thead class="text-xs font-semibold uppercase text-slate-500 bg-slate-50 border-t border-b border-slate-200">
  <tr>
    <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
      <div class="font-semibold text-left">release</div>
    </th>
    <th class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">current status</th>
  </tr>
  </thead>

  <tbody class="text-sm divide-y divide-slate-200">
  <% app.active_runs.each do |run| %>
    <tr>
      <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
        <div class="flex items-center">
          <div class="font-medium text-slate-800">
            <%= link_to release_path(run.id) do %>
              <%= run.train.name %>&nbsp;&nbsp;â€¢&nbsp;&nbsp;
              <span class="underline">
                <% if run.completed_at %>
                  <%= "#{run.release_version} released on #{run.completed_at.to_s(:short)}" %>
                <% else %>
                  <%= version_in_progress(run.release_version) %>
                <% end %>
              </span>
            <% end %>
          </div>
        </div>
      </td>

      <td class="px-2 first:pl-5 last:pr-5 py-3 whitespace-nowrap">
        <div class="px-4">
          <div class="max-w-md mx-auto w-full">
            <div class="relative">
              <% if run.all_steps.size > 1 %>
                <div class="absolute left-0 top-1/2 -mt-3 w-full h-0.5 bg-slate-200" aria-hidden="true"></div>
              <% end %>

              <ul class="relative flex justify-between w-full">
                <% run.overall_movement_status.each do |step, status_summary| %>
                  <li data-controller="tooltip"
                      data-action="mouseenter->tooltip#show mouseleave->tooltip#hide">
                    <span class="flex items-center justify-center w-6 h-6 rounded-full text-xs text-white font-semibold <%= movement_status_color(status_summary) %>">
                      <%= step.step_number %>
                    </span>

                    <div class="flex items-center">
                      <%= render partial: "shared/tooltip", locals: { content: movement_status_text(status_summary) } %>
                      <span class="flex items-center justify-center w-6 h-6 text-xs font-semibold"><%= step.name %></span>
                    </div>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </td>
    </tr>
  <% end %>
  </tbody>
</table>


