<% content_for :sticky_page_message do %>
  <%= render partial: "shared/sticky_topbar_message",
             locals: { msg: "Contact us via the chat in the bottom right corner and we'll help you get setup with your release process." } %>
<% end %>

<%= render PageComponent.new(breadcrumb: breadcrumb(:apps), title: "Apps 👩‍💻") do |page| %>
  <% page.with_action do %>
    <%= authz_link_to :green, new_app_path do %>
      <%= inline_svg("create_plus.svg", classname: "w-4 fill-current opacity-50 shrink-0") %>
      <span class="hidden xs:block ml-2">Add a new app</span>
    <% end %>
  <% end %>

  <% if @apps.any? %>
    <section>
      <h2 class="text-2xl text-slate-800 font-bold">
        <%= inline_svg("ios.svg", classname: "w-8 align-bottom inline-flex") %>
        iOS
      </h2>
      <% @apps.ios.each do |app| %>
        <div class="grid grid-cols-3 gap-1 my-3">
          <div class="bg-fuchsia-50 rounded-sm pl-4 pt-4">
            <%= app.name %> –
            <%= app.bundle_identifier %>
          </div>
          <% app.high_level_overview.each_with_index do |(train, releases), i| %>
            <% if i > 0 %><div></div><% end %>

            <div class="bg-purple-200 rounded-sm pl-4 pt-4">
              <p class="uppercase tracking-wider text-white text-sm">Reviewing</p>
              <p class="text-xl font-bold"><%= releases[:in_review]&.release_version %></p>
              <p class="text-sm">Branch – <code><%= releases[:in_review]&.release_branch %></code></p>
              <p class="text-sm">Started on – <span><%= time_format releases[:in_review]&.created_at, with_year: true %></span></p>
            </div>

            <div class="bg-teal-600 rounded-sm pl-4 pt-4">
              <p class="uppercase tracking-wider text-white text-sm">Released</p>
              <p class="text-xl font-bold"><%= releases[:last_released]&.release_version %></p>
              <p class="text-sm">Branch – <code><%= releases[:last_released]&.release_branch %></code></p>
              <p class="text-sm">Released on – <span><%= time_format releases[:last_released]&.completed_at, with_year: true %></span></p>
            </div>
          <% end %>
        </div>
      <% end %>
    </section>

    <section>
      <h2 class="text-2xl text-slate-800 font-bold">
        <%= inline_svg("android.svg", classname: "w-8 align-bottom inline-flex") %>
        Android
      </h2>
      <% @apps.android.each do |app| %>
        <div class="grid grid-cols-3 gap-1 my-3">
          <div class="bg-fuchsia-50 rounded-sm pl-4 pt-4">
            <%= app.name %> –
            <%= app.bundle_identifier %>
          </div>
          <% app.high_level_overview.each_with_index do |(train, releases), i| %>
            <% if i > 0 %><div></div><% end %>

            <div class="bg-purple-200 rounded-sm pl-4 pt-4">
              <p class="uppercase tracking-wider text-white text-sm">Reviewing</p>
              <p class="text-xl font-bold"><%= releases[:in_review]&.release_version %></p>
              <p class="text-sm">Branch – <code><%= releases[:in_review]&.release_branch %></code></p>
              <p class="text-sm">Started on – <span><%= time_format releases[:in_review]&.created_at, with_year: true %></span></p>
            </div>

            <div class="bg-teal-600 rounded-sm pl-4 pt-4">
              <p class="uppercase tracking-wider text-white text-sm">Released</p>
              <p class="text-xl font-bold"><%= releases[:last_released]&.release_version %></p>
              <p class="text-sm">Branch – <code><%= releases[:last_released]&.release_branch %></code></p>
              <p class="text-sm">Released on – <span><%= time_format releases[:last_released]&.completed_at, with_year: true %></span></p>
            </div>
          <% end %>
        </div>
      <% end %>
    </section>


    <%= render TableComponent.new(columns: ["Name", "Description", "Bundle Identifier"]) do |table| %>
      <% @apps.each do |app| %>
        <% table.with_row do |row| %>
          <% row.with_cell do %>
            <div class="flex items-center">
              <%= inline_svg("#{app.platform}.svg", classname: "w-6 inline-flex mr-2") %>
              <div class="font-medium text-slate-800">
                <%= link_to app.name, app_path(app) %>
              </div>
            </div>
          <% end %>
          <% row.with_cell do %>
            <div class="text-left"><%= simple_format app.description %></div>
          <% end %>
          <% row.with_cell do %>
            <div class="text-left"><%= app.bundle_identifier %></div>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% else %>
    <p>Go to the
      <%= link_to "new app page", new_app_path %>
      to create an app and configure their integrations.
    </p>
  <% end %>
<% end %>
