<div class="space-y-6">
  <div>
    <h3 class="text-lg font-medium text-gray-900 mb-4">Branching Strategy Configuration</h3>
    <p class="text-sm text-gray-600 mb-6">Set up how your releases will be managed across git branches.</p>
  </div>

  <%= form_with model: onboarding_state, url: save_branching_app_onboarding_path(app), method: :post, local: true, data: {controller: "onboarding-form", turbo: true} do |form| %>
    <div class="grid grid-cols-1 gap-6">
      <!-- Branching Strategy -->
      <div>
        <%= form.label :branching_strategy, class: "block text-sm font-medium text-gray-700 mb-2" do %>
          Branching Strategy <span class="text-red-500">*</span>
        <% end %>
        <%= form.select :branching_strategy,
            options_for_select([
              ["GitHub Flow (single main branch)", "github_flow"],
              ["GitFlow (develop + main branches)", "gitflow"],
              ["Release Branches (feature branches to main)", "release_branches"]
            ], onboarding_state.branching_strategy),
            {prompt: "Select your branching strategy"},
            {class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500"} %>
        <p class="mt-1 text-xs text-gray-500">This determines how release branches are created and managed</p>
      </div>

      <!-- Source Branch -->
      <div>
        <%= form.label :source_branch, class: "block text-sm font-medium text-gray-700 mb-2" do %>
          Source Branch <span class="text-red-500">*</span>
        <% end %>
        <%= form.text_field :source_branch,
            value: onboarding_state.source_branch || "main",
            class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        <p class="mt-1 text-xs text-gray-500">The main development branch where releases are created from</p>
      </div>

      <!-- Branch Naming Format -->
      <div>
        <%= form.label :branch_naming_format, class: "block text-sm font-medium text-gray-700 mb-2" do %>
          Release Branch Format
        <% end %>
        <%= form.text_field :branch_naming_format,
            value: onboarding_state.branch_naming_format || "release/{version}",
            class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        <p class="mt-1 text-xs text-gray-500">Use {version} as placeholder. Example: release/{version} becomes release/1.2.0</p>
      </div>

      <!-- Release Branch Format (for GitFlow) -->
      <div id="release_branch_section" class="<%= onboarding_state.branching_strategy == 'gitflow' ? '' : 'hidden' %>">
        <%= form.label :release_branch_format, class: "block text-sm font-medium text-gray-700 mb-2" do %>
          Release Branch Format
        <% end %>
        <%= form.text_field :release_branch_format,
            value: onboarding_state.release_branch_format || "release/{version}",
            class: "block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500" %>
        <p class="mt-1 text-xs text-gray-500">Format for release branches in GitFlow</p>
      </div>
    </div>

    <div class="mt-6 flex justify-end">
      <%= form.submit "Save & Continue", class: "bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500", data: {onboarding_form_target: "submitButton"} %>
    </div>
  <% end %>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const branchingStrategy = document.getElementById('<%= dom_id(onboarding_state, :branching_strategy) %>')
    const releaseBranchSection = document.getElementById('release_branch_section')
    
    function toggleSections() {
      const isGitflow = branchingStrategy.value === 'gitflow'
      releaseBranchSection.classList.toggle('hidden', !isGitflow)
    }
    
    branchingStrategy.addEventListener('change', toggleSections)
    toggleSections() // Set initial state
  })
</script>