<div class="mb-5 flex justify-between items-center">
  <div>
    <%= render partial: "shared/live_release/section_title", locals: {heading: "Summary", subheading: "#{time_ago_in_words(release.completed_at)} ago"} %>
    <div class="text-slate-600 animate-bounce mt-2">
      Great work team! This release is complete!
    </div>
  </div>

  <div class="cursor-pointer text-2xl"
       data-controller="confetti"
       data-action="click->confetti#spray"
       data-confetti-animation-value="school-pride"
       data-confetti-follow-value=false
       data-confetti-duration-value="1">ðŸŽ‰</div>
</div>

<% finalize_metadata = release.finalize_phase_metadata %>

<div class="mt-4 bg-indigo-50 rounded-md border border-indigo-200">
  <div class="py-4 px-8 lg:px-8 text-sm">
    <div class="max-w-sm mx-auto lg:max-w-none">
      <div class="font-semibold text-slate-800 mb-1">Release Summary</div>

      <ul class="mt-3">
        <li class="flex items-center justify-between py-3">
          <div>Total Run Time</div>
          <div class="text-slate-800 ml-2">
            <%= finalize_metadata.dig(:total_run_time) %>
          </div>
        </li>

        <% if finalize_metadata.dig(:release_tag).present? %>
          <li class="flex items-center justify-between py-3 border-t border-indigo-200">
            <div>Release Tag</div>
            <div class="flex items-center whitespace-nowrap">
              <%= image_tag("git_tag.svg", width: 20, class: "inline-flex mr-2") %>
              <div class="font-mono text-slate-800">
                <%= link_to_external finalize_metadata.dig(:release_tag),
                                     finalize_metadata.dig(:release_tag_url) %>
              </div>
            </div>
          </li>
        <% end %>

        <% release.release_platform_runs.each do |run| %>
          <% last_deployment_run = run.last_good_step_run&.deployment_runs.last %>
          <% if last_deployment_run&.deployment.controllable_rollout? %>
            <li class="flex items-center justify-between py-3 border-t border-indigo-200">
              <div>Release % to users</div>
              <div class="flex items-center whitespace-nowrap">
                <%= number_to_percentage(last_deployment_run.rollout_percentage) %>
                (<%= link_to_external "Edit on Play Store", "https://play.google.com/console/u/0/developers", class: "underline" %>
                )
              </div>
            </li>
          <% end %>
        <% end %>

        <% unless finalize_metadata.dig(:final_artifact_url).nil? %>
          <li class="flex items-center justify-between py-3 border-t border-indigo-200">
            <div>Final Release Build</div>
            <div class="flex items-center whitespace-nowrap">
              <%= image_tag("link.svg", width: 20, class: "inline-flex mr-2") %>
              <div class="text-slate-800">
                <%= link_to_external "Download Artifact", finalize_metadata.dig(:final_artifact_url) %>
              </div>
            </div>
          </li>
        <% end %>

        <% unless finalize_metadata.dig(:store_url).nil? %>
          <li class="flex items-center justify-between py-3 border-t border-indigo-200">
            <div>Store Link</div>
            <div class="flex items-center whitespace-nowrap">
              <%= link_to_external image_tag("link_external.svg", width: 20, class: "inline-flex mr-2"),
                                   finalize_metadata.dig(:store_url) %>
            </div>
          </li>
        <% end %>
      </ul>

      <% if post_release_prs&.exists? %>
        <div class="mt-6">
          <div class="font-semibold text-slate-800 mb-1">Pull Requests</div>
        </div>

        <%= render partial: "shared/live_release/pull_requests", locals: { prs: post_release_prs } %>
      <% end %>
    </div>
  </div>
</div>

