<% if @unconfigured %>
  <%= render V2::EmptyStateComponent.new(title: "Release health rules are unavailable",
                                         text: "Release health can only be configured when you have a Monitoring Integration setup for your app.",
                                         banner_image: "art/no_releases.png") do %>
    <div>
      <%= render V2::ButtonComponent.new(scheme: :default,
                                         type: :link,
                                         label: "Configure Monitoring",
                                         options: app_integrations_path(app),
                                         size: :xxs) do |b| %>
        <% b.with_icon("v2/cog.svg", size: :md) %>
      <% end %>
    </div>
  <% end %>
<% else %>
  <% train.release_platforms.each do |release_platform| %>
    <%= render V2::SectionComponent.new(style: :titled,
                                        title: "#{release_platform.display_attr(:platform)}",
                                        subtitle: "Configure key health metrics for monitoring the status of releases as they are rolled out") do |section| %>
      <% section.with_sidenote do %>
        <%= render V2::ModalComponent.new(title: "Add a new rule") do |modal| %>
          <% modal.with_button(label: "Add", scheme: :light, type: :action, size: :xxs, arrow: :none)
                  .with_icon("v2/plus.svg", size: :md) %>
          <% modal.with_body do %>
            <%= render partial: "trains/rule_form", locals: { app: @app, train: @train, release_platform:, rule: release_platform.release_health_rules.new } %>
          <% end %>
        <% end %>
      <% end %>

      <% if release_platform.release_health_rules.exists? %>
        <div class="flex flex-row gap-4">
          <% release_platform.release_health_rules.each do |rule| %>
            <div class="flex flex-col justify-between gap-4 mt-4 border-default box-padding min-w-80">
              <div class="flex items-center gap-4 justify-between">
                <div class="heading-3"><%= rule.name %></div>
                <%= render V2::ButtonComponent.new(
                  scheme: :danger,
                  options: app_train_platform_release_health_rule_path(app, train, release_platform, rule),
                  type: :button,
                  size: :xxs,
                  turbo: false,
                  html_options: { method: :delete, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want remove the release health rule?" } }) do |b|
                  b.with_icon("v2/trash.svg", size: :sm)
                end %>
              </div>
              <h4 class="heading-4">Unhealthy if</h4>
              <div class="flex flex-col">
                <% rule.trigger_rule_expressions.each_with_index do |expr, idx| %>
                  <% if idx > 0 %>
                    <div class="text-base text-main-400/50 my-1">OR</div>
                  <% end %>
                  <div class="text-sm text-gray-900"><%= expr.to_s(:unhealthy) %></div>
                <% end %>
              </div>
              <% if rule.filter_rule_expressions.exists? %>
                <h4 class="heading-4">When</h4>
                <div class="flex flex-col">
                  <% rule.filter_rule_expressions.each_with_index do |expr, idx| %>
                    <% if idx > 0 %>
                      <div class="text-base text-main-400/50 my-1">AND</div>
                    <% end %>
                    <div class="text-sm text-gray-900"><%= expr.to_s(:unhealthy) %></div>
                  <% end %>
                </div>
              <% end %>
            </div>
          <% end %>
        </div>
      <% else %>
        <%= render V2::EmptyStateComponent.new(title: "No rules configured",
                                               text: "Add rules to monitor the health of releases on this platform",
                                               banner_image: "v2/list_checks.svg",
                                               type: :subdued) %>
      <% end %>
    <% end %>
  <% end %>
<% end %>
