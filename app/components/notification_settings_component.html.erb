<% if enabled? %>
  <section class="my-4">
    <div class="px-5 py-3 bg-indigo-50 border border-indigo-100 rounded-sm text-left">
      <div class="text-slate-700 text-sm">To disable all notifications, go to
        <%= link_to "Train Settings", edit_app_train_path(train.app, train), class: "underline", data: { turbo: false } %>
        .
      </div>
    </div>
  </section>
  <%= render V2::TableComponent.new(columns: %w[kind channels status settings]) do |table| %>
    <% display_settings.each do |setting| %>
      <% table.with_row do |row| %>
        <% row.with_cell do %>
          <div class="inline-flex items-center">
            <%= render V2::IconComponent.new(icon_for(setting), size: :md, classes: "mr-2") %>
            <%= setting.display_attr(:kind) %>
          </div>
        <% end %>

        <% row.with_cell do %>
          <% if setting.active? %>
            <div class="overflow-x-hidden hover:overflow-x-auto">
              <% setting.notification_channels&.each do |channel| %>
                <div class="inline-flex items-center">
                  <%= render V2::IconComponent.new("integrations/logo_#{setting.notification_provider}.png", size: :md, classes: "mr-2") %>
                  <%= channel["name"] %>
                </div>
              <% end %>
            </div>
          <% end %>
        <% end %>

        <% row.with_cell do %>
          <%= render V2::StatusIndicatorPillComponent.new(text: status_text(setting), status: status_type(setting)) %>
        <% end %>

        <% row.with_cell do %>
          <%= render V2::ModalComponent.new(title: setting.display_attr(:kind)) do |modal| %>
            <% button = modal.with_button(scheme: :light,
                                          type: :action,
                                          size: :xxs,
                                          arrow: :none) %>
            <% button.with_icon("v2/pencil.svg") %>
            <% modal.with_body do %>
              <%= render partial: "form", locals: { app: train.app,
                                                    train: train,
                                                    notification_setting: setting,
                                                    description: description_for(setting),
                                                    icon: icon_for(setting) } %>
            <% end %>
          <% end %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% else %>
  <p>Enable notification for the app and the train to configure notification settings.</p>
<% end %>
