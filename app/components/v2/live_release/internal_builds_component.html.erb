<%= render V2::PlatformViewComponent.new(@release) do |component| %>
  <div class="flex flex-col section-gap-default">
    <% component.runs do |release_platform_run| %>
      <% if configured?(release_platform_run) %>
        <%= render V2::LiveRelease::SubmissionConfigComponent.new(configuration(release_platform_run), internal_workflow_config(release_platform_run), release_platform_run:) %>
      <% else %>
        <%= render V2::EmptyStateComponent.new(
          title: "No internal build step configured",
          text: "Please configure an internal build step for the train to see the build status.",
          banner_image: "v2/drill.svg",
          type: :subdued) %>
      <% end %>
    <% end %>

    <% component.runs do |release_platform_run| %>
      <% latest_release = latest_internal_release(release_platform_run) %>
      <% if latest_release.present? %>
        <%= render V2::LiveRelease::PreProdRelease::CurrentReleaseComponent.new(latest_release) %>
      <% end %>
    <% end %>
  </div>

  <% if component.platform_runs.any? { |sr| sr.external_builds.exists? } %>
    <% component.runs do |release_platform_run| %>
      <%= render V2::SectionComponent.new(title: "Build stats", style: :titled, size: :compact) do %>
        <% if release_platform_run.internal_builds.any? { |build| build.metadata.present? } %>
          <div>TODO: [V2] Show build health here</div>
        <% else %>
          <%= render V2::EmptyStateComponent.new(
            title: "No stats for this platform",
            text: "Please send build metadata to Tramline to see the build stats.",
            banner_image: "v2/drill.svg",
            type: :subdued) %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>

  <% component.runs do |release_platform_run| %>
    <% if previous_internal_releases(release_platform_run).present? %>
      <%= render V2::SectionComponent.new(title: "Other builds (#{previous_internal_releases(release_platform_run).size})", style: :titled, size: :compact) do %>
        <div class="flex flex-col item-gap-default">
          <% previous_internal_releases(release_platform_run).each do |internal_release| %>
            <%= render V2::LiveRelease::PreProdRelease::PreviousReleaseComponent.new(internal_release) %>
          <% end %>
        </div>
      <% end %>
    <% end %>
  <% end %>
<% end %>
