<header class="antialiased my-1">
  <nav class="bg-white border-gray-200 px-5 lg:px-5 dark:bg-gray-900">
    <div class="flex justify-between items-center">
      <div class="flex justify-start items-center">
        <a href="/" class="flex mr-6">
          <%= inline_svg("tramline.svg", classname: "inline-flex w-12") %>
        </a>
      </div>

      <div class="flex flex-wrap justify-between items-center py-3 px-4 pb-5 sm:pb-3 lg:px-6">
        <div class="flex items-center mb-2 sm:mb-0">
          <%= render V2::DropdownComponent.new do |dropdown| %>
            <% dropdown.with_button(visual_icon: "building").with_title_text do %>
              <div class="text-left">
                <div class="text-sm font-semibold leading-none text-gray-900 dark:text-white">
                  <%= current_organization.name %>
                </div>
              </div>
            <% end %>

            <% dropdown.with_item_group do |group| %>
              <% current_user.organizations.each do |organization| %>
                <% group.with_item(link: { path: switch_accounts_organization_path(organization) }, selected: organization.id == current_organization.id) do %>
                  <div class="text-left">
                    <div class="font-medium leading-none text-gray-900 dark:text-white mb-0.5 text-sm">
                      <%= organization.name %>
                    </div>

                    <div class="text-xs text-gray-500 dark:text-gray-400">
                      Created <%= time_format organization.created_at, with_year: true, with_time: false %>
                    </div>
                  </div>
                <% end %>
              <% end %>
            <% end %>
          <% end %>

          <% if default_app %>
            <%= inline_svg("layer_separator.svg", classname: "w-3 h-3 text-gray-500 dark:text-gray-400 mx-2") %>

            <%= render V2::DropdownComponent.new do |dropdown| %>
              <% dropdown.with_button(visual_icon: "https://flowbite.s3.amazonaws.com/blocks/marketing-ui/avatars/bonnie-green.png",
                                              visual_icon_type: :external,
                                              size: :none,
              ).with_title_text do %>
                <div class="text-left">
                  <div class="text-sm font-semibold leading-none text-gray-900 dark:text-white">
                    <%= default_app.name %>
                    <span class="text-gray-500 dark:text-gray-400"><%= default_app.bundle_identifier %></span>
                  </div>
                </div>
              <% end %>

              <% dropdown.with_item_group do |group| %>
                <% current_organization.apps.each do |app| %>
                  <% group.with_item(link: { path: app_path(app) }, selected: app.id == default_app.id) do %>
                    <div class="text-left">
                      <div class="font-medium leading-none text-gray-900 dark:text-white mb-0.5 text-sm">
                        <%= app.name %>
                      </div>
                      <div class="text-xs text-gray-500 dark:text-gray-400">
                        <%= app.bundle_identifier %>
                      </div>
                    </div>
                  <% end %>
                <% end %>
              <% end %>
            <% end %>

            <%= render V2::ButtonComponent.new(
              scheme: :light,
              visual_icon: "v2/cog",
              options: edit_app_path(default_app),
              type: :link,
              size: :xxs,
              tooltip: "App Settings",
              html_options: { class: "ml-2" }
            ) %>

            <%= render V2::ModalComponent.new(title: "Add a new app") %>

            <%= render V2::ButtonComponent.new(
              scheme: :light,
              visual_icon: "box",
              options: new_app_path,
              type: :link,
              size: :xxs,
              label: "Store Status",
              html_options: { class: "ml-2" }
            ) %>
          <% end %>
        </div>
      </div>

      <div class="flex justify-end items-center lg:order-2">
        <%= link_to_external "https://docs.tramline.app",
                             class: "text-gray-500 rounded-lg hover:text-gray-900 hover:bg-gray-100 dark:text-gray-400 dark:hover:text-white dark:hover:bg-gray-700" do %>
          <span class="sr-only">View Docs</span>
          <%= inline_svg("book.svg", classname: "w-4 h-4") %>
        <% end %>

        <span class="mx-4 w-px h-5 bg-gray-200 dark:bg-gray-600"></span>

        <%= render V2::DropdownComponent.new do |dropdown| %>
          <% dropdown.with_button(visual_icon: "https://flowbite.com/docs/images/people/profile-picture-5.jpg",
                                          visual_icon_type: :external,
                                          size: :none,
                                          html_options: { class: "flex" },
                                          scheme: :icon_only) %>

          <!-- <%# button.with_subtext do %> -->
          <!--            <div class="py-3 px-4">-->
          <!--              <span class="block text-sm font-semibold text-gray-900 dark:text-white">-->
          <%#= user_name %>
          <!--              </span>-->
          <!--              <span class="block text-sm text-gray-500 truncate dark:text-gray-400">-->
          <%#= user_email %>
          <!--              </span>-->
          <!--            </div>-->
          <%# end %>

          <% dropdown.with_item_group(list_style: "p-1 text-gray-500 dark:text-gray-400") do |group| %>
            <% group.with_item(link: { path: edit_accounts_organization_path(current_organization), "data-turbo": false, class: USER_PROFILE_LINK_CLASSES }) do %>
              Settings
            <% end %>

            <% if billing? %>
              <% group.with_item(link: { path: billing_link, external: true, class: USER_PROFILE_LINK_CLASSES }) do %>
                Go to billing ↗
              <% end %>
            <% end %>

            <% group.with_item(link: { path: "https://calendar.app.google/bs6wimzo316W3yKz9", external: true, class: USER_PROFILE_LINK_CLASSES }) do %>
              Book a demo ↗
            <% end %>
          <% end %>

          <% dropdown.with_item_group(list_style: "p-1 text-gray-500 dark:text-gray-400") do |group| %>
            <% group.with_item(link: { path: destroy_user_session_path, "data-turbo": false, class: USER_PROFILE_LINK_CLASSES }) do %>
              Sign out
            <% end %>
          <% end %>
        <% end %>
      </div>
    </div>
  </nav>
</header>
